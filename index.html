<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AR NFT - CentrÃ© sur Image</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
  <style>
    body { margin: 0; overflow: hidden; font-family: sans-serif; }
    #overlay {
      position: absolute; z-index: 999; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center;
      color: white; text-align: center; cursor: pointer;
    }
    .start-msg { border: 2px solid #00E676; padding: 15px; border-radius: 10px; background: rgba(0,230,118,0.1); }
  </style>
</head>

<body style="margin:0; overflow:hidden;">

  <!-- Overlay pour lancer la camÃ©ra -->
  <div id="overlay">
    <div class="start-msg">
      <h1>ðŸŽ¯ SCANNEZ Lâ€™IMAGE</h1>
      <p>Cliquez pour activer la camÃ©ra<br>Puis scannez <b>img1</b></p>
    </div>
  </div>

  <a-scene embedded 
           arjs="sourceType: webcam; trackingMethod: nft; debugUIEnabled: false;" 
           renderer="antialias: true; colorManagement: true;"
           cursor="rayOrigin: mouse" raycaster="objects: .clickable">
    
    <a-assets>
      <!-- âš ï¸ Mets ici le chemin rÃ©el de ta vidÃ©o -->
      <video id="maVideo" src="IMG.MP4" crossorigin="anonymous" playsinline webkit-playsinline loop></video>
    </a-assets>

    <!-- Marqueur NFT -->
    <a-nft type="nft" url="nft/img1/img1" id="nftMarker">
      <a-plane rotation="-90 0 0" width="1" height="1" color="#00E676" opacity="0.2"></a-plane>
    </a-nft>

    <!-- Contenu fixe qui sâ€™affiche quand le marqueur est reconnu -->
    <a-entity id="fixedContent" visible="false" position="0 0.5 0" scale="0.01 0.01 0.01">
      <a-video id="videoScreen" class="clickable" src="#maVideo" width="1.1" height="0.62" position="0 0.3 0"></a-video>
      <a-rect width="1.15" height="0.67" position="0 0.3 -0.01" material="color: #00E676; opacity: 0.2; shader: flat;"></a-rect>
    </a-entity>

    <a-entity camera look-controls></a-entity>
  </a-scene>

  <script>
    const video = document.querySelector("#maVideo");
    const fixedContent = document.querySelector("#fixedContent");
    const marker = document.querySelector("#nftMarker");

    // Activer la camÃ©ra aprÃ¨s clic
    document.querySelector("#overlay").addEventListener('click', function() {
      this.style.display = 'none';
      video.play().then(() => video.pause()); // dÃ©bloque lâ€™autoplay
    });

    // Quand le marqueur est trouvÃ©
    marker.addEventListener("markerFound", () => {
      if (fixedContent.getAttribute("visible") === "false" || !fixedContent.getAttribute("visible")) {
        const worldPos = new THREE.Vector3();
        marker.object3D.getWorldPosition(worldPos);

        // Centrer le contenu au-dessus du marqueur
        fixedContent.object3D.position.set(worldPos.x, worldPos.y + 0.5, worldPos.z);

        fixedContent.setAttribute("visible", "true");
        fixedContent.setAttribute("animation", {
          property: 'scale',
          to: '1 1 1', 
          dur: 800,
          easing: 'easeOutBack'
        });
        video.play();
      }
    });

    // Quand le marqueur est perdu
    marker.addEventListener("markerLost", () => {
      fixedContent.setAttribute("visible", "false");
      video.pause();
    });
  </script>
</body>
</html>
